<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Optimization • epicUS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Optimization">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epicUS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.33.99999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BackgroundEPIC.html">EPIC Background</a>
    </li>
    <li>
      <a href="../articles/Calibrate_COPD_Exacerbations.html">Calibrate COPD Exacerbations</a>
    </li>
    <li>
      <a href="../articles/Calibrate_COPD_Prevalence.html">Calibrate COPD Prevalence</a>
    </li>
    <li>
      <a href="../articles/Calibrate_Smoking.html">Calibrate Smoking Status</a>
    </li>
    <li>
      <a href="../articles/GettingStarted.html">Getting Started with EPIC</a>
    </li>
    <li>
      <a href="../articles/Optimization.html">Optimization</a>
    </li>
    <li>
      <a href="../articles/Payoffs.html">Payoffs</a>
    </li>
    <li>
      <a href="../articles/RecalibratingEPIC.html">RecalibratingEPIC</a>
    </li>
    <li>
      <a href="../articles/Rep_bgd_Canada.html">Reproducing Background Mortality</a>
    </li>
    <li>
      <a href="../articles/Reproducing_bgd.html">Reproducing Background Mortality</a>
    </li>
    <li>
      <a href="../articles/UsingEPICinR.html">Using EPIC in R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Optimization</h1>
            
      

      <div class="hidden name"><code>Optimization.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we will walk through the process of optimizing
parameters for two equations: the longevity equation
<code>l_inc_betas</code> and the incidence equation
<code>ln_h_bgd_betas</code>. Specifically, we aim to optimize these
parameters to minimize the Root Mean Squared Error (RMSE) between the
projected population sizes and actual U.S. population data for certain
age groups.</p>
<p>We perform optimization using the optim function in R, and the goal
is to fine-tune the model’s parameters so that the RMSE is minimized. We
focus on two specific age groups for optimization—40-59 and 60-79—while
excluding the 80+ age group, as the RMSE for this group was
significantly high, contributing excessively to the overall error.</p>
<div class="section level3">
<h3 id="step-1load-libraries-and-setup">Step 1:Load Libraries and Setup<a class="anchor" aria-label="anchor" href="#step-1load-libraries-and-setup"></a>
</h3>
<p>Here, we load the necessary libraries. We also set the default
simulation settings and specify the time horizon for the simulation (56
years).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(epicUS)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>USSimulation <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">system.file</span>(<span class="st">"USSimulation.csv"</span>, <span class="at">package =</span> <span class="st">"epicUS"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>                         </span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>settings <span class="ot">&lt;-</span> <span class="fu">get_default_settings</span>()</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>settings<span class="sc">$</span>record_mode <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>settings<span class="sc">$</span>n_base_agents <span class="ot">&lt;-</span> settings<span class="sc">$</span>n_base_agents</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>input <span class="ot">&lt;-</span> <span class="fu">get_input</span>()</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>time_horizon <span class="ot">&lt;-</span> <span class="dv">56</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>input<span class="sc">$</span>values<span class="sc">$</span>global_parameters<span class="sc">$</span>time_horizon <span class="ot">&lt;-</span> time_horizon</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-define-the-rmse-calculation-function">Step 2: Define the RMSE Calculation Function<a class="anchor" aria-label="anchor" href="#step-2-define-the-rmse-calculation-function"></a>
</h3>
<p>The <code>calculate_rmse_optim</code> function calculates the RMSE
for each iteration of parameter optimization. Within this function:</p>
<ol style="list-style-type: decimal">
<li>We assign the first three values of the parameter vector
(params[1:3]) to l_inc_betas, which represents parameters for the
longevity equation.</li>
<li>The next four values (params[4:7]) are assigned to the
ln_h_bgd_betas vector, which is part of the incidence equation. 3)The
model is then run using the updated parameters, and we extract the
projected population sizes (EPIC_popsize) and calculate the RMSE between
the projected and observed U.S. population data for the specified age
ranges.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># RMSE function for optimization</span></span>
<span><span class="va">calculate_rmse_optim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/init_session.html">init_session</a></span><span class="op">(</span>settings <span class="op">=</span> <span class="va">settings</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#assigning first 3 values to l_inc_betas</span></span>
<span>  <span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">agent</span><span class="op">$</span><span class="va">l_inc_betas</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># assigning the next 4 values to the first four ln_h_bgd_betas, others = 0</span></span>
<span>  <span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">agent</span><span class="op">$</span><span class="va">ln_h_bgd_betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    intercept <span class="op">=</span> <span class="va">params</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>    y <span class="op">=</span> <span class="va">params</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,</span>
<span>    y2 <span class="op">=</span> <span class="va">params</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>    age <span class="op">=</span> <span class="va">params</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span>,</span>
<span>    b_mi <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    n_mi <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    b_stroke <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    n_stroke <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    hf <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>input<span class="op">=</span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Cget_output_ex.html">Cget_output_ex</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/terminate_session.html">terminate_session</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="va">epic_popsize_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2015</span>, by <span class="op">=</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">time_horizon</span><span class="op">)</span>,</span>
<span>                                 <span class="va">output</span><span class="op">$</span><span class="va">n_alive_by_ctime_age</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">epic_popsize_age</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">epic_popsize_age</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">epic_popsize_age</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">epic_popsize_age</span> <span class="op">&lt;-</span> <span class="va">epic_popsize_age</span><span class="op">[</span>, <span class="op">-</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">epic_popsize_age_long</span> <span class="op">&lt;-</span> <span class="va">epic_popsize_age</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">year</span>, names_to <span class="op">=</span> <span class="st">"age"</span>, values_to <span class="op">=</span> <span class="st">"EPIC_popsize"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="va">validate_pop_size_scaled</span> <span class="op">&lt;-</span> <span class="va">USSimulation</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>US_popsize <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">epic_popsize_age_long</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"age"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>EPIC_output_scaled <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2015</span>, <span class="va">US_popsize</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># calculate total population and growth rates</span></span>
<span>  <span class="va">total_epic_by_year</span> <span class="op">&lt;-</span> <span class="va">validate_pop_size_scaled</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_EPIC_output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">EPIC_popsize</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>growth_rate <span class="op">=</span> <span class="va">total_EPIC_output</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">total_EPIC_output</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="va">df_with_growth</span> <span class="op">&lt;-</span> <span class="va">validate_pop_size_scaled</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">total_epic_by_year</span>, by <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">age</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      EPIC_output_scaled <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2015</span>, <span class="va">US_popsize</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      EPIC_output_scaled <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="external-link">replace_na</a></span><span class="op">(</span><span class="va">EPIC_output_scaled</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">US_popsize</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumprod</a></span><span class="op">(</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="external-link">replace_na</a></span><span class="op">(</span><span class="va">growth_rate</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># filter and sum population data by age group (40-59 and 60-79)</span></span>
<span>  <span class="va">df_summed_ranges</span> <span class="op">&lt;-</span> <span class="va">df_with_growth</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      age_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>        <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">40</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">59</span> <span class="op">~</span> <span class="st">"40-59"</span>,</span>
<span>        <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">60</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">79</span> <span class="op">~</span> <span class="st">"60-79"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"40-59"</span>, <span class="st">"60-79"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">age_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_EPIC_population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">EPIC_output_scaled</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>              total_US_population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">US_popsize</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># calculating RMSE of each age group across years</span></span>
<span>  <span class="va">rmse_per_range</span> <span class="op">&lt;-</span> <span class="va">df_summed_ranges</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>      rmse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">total_EPIC_population</span> <span class="op">-</span> <span class="va">total_US_population</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># summing all the age ranges</span></span>
<span>  <span class="va">total_rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rmse_per_range</span><span class="op">$</span><span class="va">rmse</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Params:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">params</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"RMSE:"</span>, <span class="va">total_rmse</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">total_rmse</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-3-define-initial-guess-bounds-and-run-optimization">Step 3: Define Initial Guess, Bounds, and Run Optimization<a class="anchor" aria-label="anchor" href="#step-3-define-initial-guess-bounds-and-run-optimization"></a>
</h3>
<p>We now define our initial guess for the parameters and set the bounds
for each parameter. The optimization method used is L-BFGS-B, which is
well-suited for differentiable functions with bounds. We also specify
the stopping criterion.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">initial_guess</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.5</span>, <span class="fl">0.0005</span>, <span class="op">-</span><span class="fl">0.00005</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">0.025</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lower_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.6</span>, <span class="fl">0.0001</span>, <span class="op">-</span><span class="fl">0.0001</span>, <span class="op">-</span><span class="fl">0.0005</span>, <span class="op">-</span><span class="fl">0.0001</span>, <span class="op">-</span><span class="fl">0.0005</span>, <span class="op">-</span><span class="fl">0.0005</span><span class="op">)</span></span>
<span><span class="va">upper_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.45</span>, <span class="fl">0.01</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># here i am using L-BFGS-B because RMSE is a differentiable function</span></span>
<span><span class="co"># we can define lower and upper bounds,</span></span>
<span><span class="co">#more memory efficient in BFGS, making it suitable for large parameter spaces.</span></span>
<span><span class="va">result_optim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span></span>
<span>  par <span class="op">=</span> <span class="va">initial_guess</span>,</span>
<span>  fn <span class="op">=</span> <span class="va">calculate_rmse_optim</span>,</span>
<span>  lower <span class="op">=</span> <span class="va">lower_bounds</span>,</span>
<span>  upper <span class="op">=</span> <span class="va">upper_bounds</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">20</span>, iterlim <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Optimal Growth Rate:"</span>, <span class="va">result_optim</span><span class="op">$</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Optimized RMSE:"</span>, <span class="va">result_optim</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-4-optimal-parameters-and-result">Step 4: Optimal Parameters and Result<a class="anchor" aria-label="anchor" href="#step-4-optimal-parameters-and-result"></a>
</h3>
<p>After running the optimization process, we obtain the optimal values
for the parameters. These values minimize the RMSE for the specified age
groups (40-59 and 60-79) and exclude the 80+ age group.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.48672063032448</span>, <span class="fl">0.00202274171887977</span>, <span class="op">-</span><span class="fl">4.37035899506131e-05</span>, </span>
<span>            <span class="fl">0</span>, <span class="op">-</span><span class="fl">1e-04</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">0.000132065698144107</span><span class="op">)</span></span></code></pre></div>
<p>These are the optimized parameters that yield the lowest RMSE, and
they reflect the best possible values for the model in terms of
population size predictions for the selected age groups.</p>
</div>
<div class="section level3">
<h3 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h3>
<p>In this section, we visualize and compare the population trends over
time for different age groups using the optimized parameters and U.S.
population data.</p>
<pre><code><span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre>
<p><img src="Optimization_files/figure-html/unnamed-chunk-7-1.png" width="768"><img src="Optimization_files/figure-html/unnamed-chunk-7-2.png" width="768"><img src="Optimization_files/figure-html/unnamed-chunk-7-3.png" width="768"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mohsen Sadatsafavi, Amin Adibi, Kate Johnson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
