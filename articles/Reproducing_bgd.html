<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reproducing Background Mortality â€¢ epicUS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reproducing Background Mortality">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epicUS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.33.99999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BackgroundEPIC.html">EPIC Background</a>
    </li>
    <li>
      <a href="../articles/Calibrate_COPD_Exacerbations.html">Calibrate COPD Exacerbations</a>
    </li>
    <li>
      <a href="../articles/Calibrate_COPD_Prevalence.html">Calibrate COPD Prevalence</a>
    </li>
    <li>
      <a href="../articles/Calibrate_Demographics.html">Calibrate Demographics</a>
    </li>
    <li>
      <a href="../articles/Calibrate_Smoking.html">Calibrate Smoking Status</a>
    </li>
    <li>
      <a href="../articles/GettingStarted.html">Getting Started with EPIC</a>
    </li>
    <li>
      <a href="../articles/Payoffs.html">Payoffs</a>
    </li>
    <li>
      <a href="../articles/Reproducing_bgd.html">Reproducing Background Mortality</a>
    </li>
    <li>
      <a href="../articles/UsingEPICinR.html">Using EPIC in R</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Reproducing Background Mortality</h1>
            
      

      <div class="hidden name"><code>Reproducing_bgd.Rmd</code></div>

    </div>

    
    
<p>In this document, we aim to explore how the model behaves when
COPD-related mortality is turned off. Specifically, our goal is to
observe probability of death values that closely align with the
background mortality rates from official U.S. sources. This is the
expected behavior, as disabling exacerbation-related deaths causes the
model to no longer predict mortality from exacerbations, which should
result in values matching the background mortality rates.</p>
<p>To achieve this, we followed the series of steps below:</p>
<div class="section level3">
<h3 id="step-1-shutting-off-exacerbation-related-mortality-">Step 1: Shutting off exacerbation related mortality.<a class="anchor" aria-label="anchor" href="#step-1-shutting-off-exacerbation-related-mortality-"></a>
</h3>
<p>First, we set the intercept of the exacerbation equation to a high
value, effectively disabling death from exacerbations in the model. This
adjustment is made by changing the relevant variable as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epicUS</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"epicUS"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] '0.33.99999'</span></span>
<span><span class="va">input</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/get_input.html">get_input</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">exacerbation</span><span class="op">$</span><span class="va">logit_p_death_by_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  male <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="op">-</span><span class="fl">13000</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.05</span><span class="op">)</span>, mild <span class="op">=</span> <span class="fl">0</span>, moderate <span class="op">=</span> <span class="fl">0</span>, severe <span class="op">=</span> <span class="fl">7.4</span>,</span>
<span>    very_severe <span class="op">=</span> <span class="fl">8</span>, n_hist_severe_exac <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="op">-</span><span class="fl">13000</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.05</span><span class="op">)</span>, mild <span class="op">=</span> <span class="fl">0</span>, moderate <span class="op">=</span> <span class="fl">0</span>, severe <span class="op">=</span> <span class="fl">7.4</span>,</span>
<span>    very_severe <span class="op">=</span> <span class="fl">8</span>, n_hist_severe_exac <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#also setting exlicit mortality = 0 so there is no correction made</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">manual</span><span class="op">$</span><span class="va">explicit_mortality_by_age_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>    male <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">111</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    female <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">111</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-setting-longevitiy-related-parameters-to-0-">Step 2: Setting longevitiy-related parameters to 0.<a class="anchor" aria-label="anchor" href="#step-2-setting-longevitiy-related-parameters-to-0-"></a>
</h3>
<p>Longevity is another factor in the model that influences population.
To ensure that no external factors impact the population, we set these
parameters to 0. This adjustment can be made in the input.R file.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">agent</span><span class="op">$</span><span class="va">ln_h_bgd_betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">0</span>, y2 <span class="op">=</span> <span class="fl">0</span>, age <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                            b_mi <span class="op">=</span> <span class="fl">0</span>, n_mi <span class="op">=</span> <span class="fl">0</span>, b_stroke <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                            n_stroke <span class="op">=</span> <span class="fl">0</span>, hf <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-3-run-the-model-for-1-year-and-retrieve-events-matrix">Step 3: Run the model for 1 year and retrieve events matrix<a class="anchor" aria-label="anchor" href="#step-3-run-the-model-for-1-year-and-retrieve-events-matrix"></a>
</h3>
<p>Initially we run the model for 1 year and get the events matrix. This
matrix logs all the events that individuals go through thoughout the
model. We will use this matrix to calculate death probabilities produced
by epicUS</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epicUS</span><span class="op">)</span></span>
<span><span class="va">settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_default_settings.html">get_default_settings</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">settings</span><span class="op">$</span><span class="va">record_mode</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">settings</span><span class="op">$</span><span class="va">n_base_agents</span> <span class="op">&lt;-</span> <span class="fl">3.5e5</span></span>
<span></span>
<span><span class="fu"><a href="../reference/init_session.html">init_session</a></span><span class="op">(</span>settings <span class="op">=</span> <span class="va">settings</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initializing the session</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co"># input &lt;- get_input()</span></span>
<span></span>
<span><span class="co"># set time horizon as 1 initially </span></span>
<span><span class="va">time_horizon</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">global_parameters</span><span class="op">$</span><span class="va">time_horizon</span> <span class="op">&lt;-</span> <span class="va">time_horizon</span></span>
<span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/Cget_all_events_matrix.html">Cget_all_events_matrix</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/terminate_session.html">terminate_session</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Terminating the session</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="co"># checking to make sure event 7 (death by exacerbation) is not included </span></span>
<span><span class="co"># because we shut that off in the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">events</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0 14 13  5  6  3  4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">events</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      0      3      4      5      6     13     14 </span></span>
<span><span class="co">#&gt; 350001   8227   1485  30790  30360   9136 350001</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-4-calculating-probability-of-death-from-events-matrix">Step 4: Calculating probability of death from events matrix<a class="anchor" aria-label="anchor" href="#step-4-calculating-probability-of-death-from-events-matrix"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we will group by age so we convert ages into whole numbers.</span></span>
<span><span class="va">events</span> <span class="op">&lt;-</span> <span class="va">events</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_and_local <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">local_time</span> <span class="op">+</span> <span class="va">age_at_creation</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter events to identify individuals who have experienced event 14,</span></span>
<span><span class="co"># while also creating a flag for whether they ever experienced event 13 (death)</span></span>
<span><span class="va">events_filtered</span><span class="op">&lt;-</span> <span class="va">events</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>death<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">event</span><span class="op">==</span><span class="fl">13</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ever_death <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">death</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">event</span><span class="op">==</span><span class="fl">14</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># calculationg probability of death</span></span>
<span><span class="va">death_prob</span><span class="op">&lt;-</span> <span class="va">events_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_and_local</span>, <span class="va">female</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    total_count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    death_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ever_death</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    death_probability <span class="op">=</span> <span class="va">death_count</span> <span class="op">/</span> <span class="va">total_count</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inspecting-the-results">Inspecting the results<a class="anchor" aria-label="anchor" href="#inspecting-the-results"></a>
</h3>
<p>We should not consider 40 year-olds beause (Amin said â€¦ )</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">death_prob</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 Ã— 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   age_and_local [8]</span></span></span>
<span><span class="co">#&gt;    age_and_local female total_count death_count death_probability</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>            40      0          17          17           1      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>            40      1           9           9           1      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>            41      0        <span style="text-decoration: underline;">4</span>567          26           0.005<span style="text-decoration: underline;">69</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>            41      1        <span style="text-decoration: underline;">4</span>567           9           0.001<span style="text-decoration: underline;">97</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>            42      0        <span style="text-decoration: underline;">4</span>540          32           0.007<span style="text-decoration: underline;">05</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>            42      1        <span style="text-decoration: underline;">4</span>436          22           0.004<span style="text-decoration: underline;">96</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>            43      0        <span style="text-decoration: underline;">4</span>497          26           0.005<span style="text-decoration: underline;">78</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>            43      1        <span style="text-decoration: underline;">4</span>385          17           0.003<span style="text-decoration: underline;">88</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>            44      0        <span style="text-decoration: underline;">4</span>654          39           0.008<span style="text-decoration: underline;">38</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>            44      1        <span style="text-decoration: underline;">4</span>688          21           0.004<span style="text-decoration: underline;">48</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>            45      0        <span style="text-decoration: underline;">5</span>019          32           0.006<span style="text-decoration: underline;">38</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>            45      1        <span style="text-decoration: underline;">4</span>960          20           0.004<span style="text-decoration: underline;">03</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>            46      0        <span style="text-decoration: underline;">5</span>110          28           0.005<span style="text-decoration: underline;">48</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>            46      1        <span style="text-decoration: underline;">5</span>187          19           0.003<span style="text-decoration: underline;">66</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>            47      0        <span style="text-decoration: underline;">4</span>814          33           0.006<span style="text-decoration: underline;">86</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">death_prob</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 Ã— 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   age_and_local [8]</span></span></span>
<span><span class="co">#&gt;    age_and_local female total_count death_count death_probability</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>            94      1         343          61             0.178</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>            95      0         235          58             0.247</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>            95      1         253          65             0.257</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>            96      0         199          59             0.296</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>            96      1         222          54             0.243</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>            97      0         136          48             0.353</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>            97      1         131          39             0.298</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>            98      0          95          31             0.326</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>            98      1          84          25             0.298</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>            99      0          51          16             0.314</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>            99      1          68          20             0.294</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>           100      0          74          36             0.486</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>           100      1          71          35             0.493</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>           101      0          47          11             0.234</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>           101      1          67          16             0.239</span></span></code></pre></div>
<p>While these values are not perfectly aligned with our validation
target, the variation is negligible.</p>
<p>Next, we want to ensure a consistent directional effect. We expect
that increasing time_horizon to 5 years will bring the results closer to
our target.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/init_session.html">init_session</a></span><span class="op">(</span>settings <span class="op">=</span> <span class="va">settings</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initializing the session</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="co"># set time horizon to 5</span></span>
<span><span class="va">time_horizon</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">global_parameters</span><span class="op">$</span><span class="va">time_horizon</span> <span class="op">&lt;-</span> <span class="va">time_horizon</span></span>
<span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span><span class="co">#&gt; ERROR:ERR_EVENT_STACK_FULL</span></span>
<span><span class="co">#&gt; [1] -4</span></span>
<span><span class="va">events5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/Cget_all_events_matrix.html">Cget_all_events_matrix</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/terminate_session.html">terminate_session</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Terminating the session</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">events</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      0      3      4      5      6     13     14 </span></span>
<span><span class="co">#&gt; 350001   8227   1485  30790  30360   9136 350001</span></span>
<span></span>
<span><span class="va">events5</span> <span class="op">&lt;-</span> <span class="va">events5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_and_local <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">local_time</span> <span class="op">+</span> <span class="va">age_at_creation</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">events5</span> <span class="op">&lt;-</span> <span class="va">events5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>local_time_adj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">events5</span><span class="op">$</span><span class="va">local_time</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># withing that year have they ever died?</span></span>
<span><span class="va">events5_filtered</span><span class="op">&lt;-</span> <span class="va">events5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>death<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">event</span><span class="op">==</span><span class="fl">13</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>,<span class="va">local_time_adj</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ever_death <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">death</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">event</span><span class="op">==</span><span class="fl">14</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">death_prob5</span><span class="op">&lt;-</span> <span class="va">events5_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_and_local</span>, <span class="va">female</span>, <span class="va">local_time_adj</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    total_count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    death_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">ever_death</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    death_probability <span class="op">=</span> <span class="va">death_count</span> <span class="op">/</span> <span class="va">total_count</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'age_and_local', 'female'. You can override</span></span>
<span><span class="co">#&gt; using the `.groups` argument.</span></span></code></pre></div>
<p>Now, when we check the results. We see that the results are even
further away:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">death_prob5</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 Ã— 6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   age_and_local, female [7]</span></span></span>
<span><span class="co">#&gt;    age_and_local female local_time_adj total_count death_count death_probability</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>            40      0              1          11          11                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>            40      1              1           6           6                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>            41      0              1          19          19                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>            41      0              2          12          12                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>            41      1              1          14          14                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>            41      1              2           6           6                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>            42      0              1          19          19                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>            42      0              2          20          20                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>            42      0              3          11          11                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>            42      1              1          10          10                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>            42      1              2           6           6                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>            42      1              3           6           6                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>            43      0              1          29          29                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>            43      0              2          30          30                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>            43      0              3          21          21                 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">death_prob5</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 Ã— 6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   age_and_local, female [7]</span></span></span>
<span><span class="co">#&gt;    age_and_local female local_time_adj total_count death_count death_probability</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>           103      0              6           1           1             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>           103      1              3           2           2             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>           103      1              4          10          10             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>           103      1              5           2           2             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>           103      1              6          11           2             0.182</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>           104      0              4           3           3             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>           104      0              5           2           2             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>           104      1              4           4           4             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>           104      1              5           1           1             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>           104      1              6           2           0             0    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>           105      0              5           2           2             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>           105      0              6           4           1             0.25 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>           105      1              5           1           1             1    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>           105      1              6           6           1             0.167</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>           106      1              6           4           1             0.25</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-results">Visualizing results<a class="anchor" aria-label="anchor" href="#visualizing-results"></a>
</h3>
<p>To better understand the differences, we visualize the results and
compare them against the target values.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">death_prob_clean</span> <span class="op">&lt;-</span> <span class="va">death_prob</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">age_and_local</span>, <span class="va">female</span>, <span class="va">death_probability</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">female</span>, values_from <span class="op">=</span> <span class="va">death_probability</span>, names_prefix <span class="op">=</span> <span class="st">"sex_"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">death_prob_clean</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Age"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">USlifetables_num</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">agent</span><span class="op">$</span><span class="va">p_bgd_by_sex</span></span>
<span></span>
<span></span>
<span><span class="va">USlifetables_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Age <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">USlifetables_num</span><span class="op">)</span>,  <span class="co"># Start age from 1</span></span>
<span>  Male <span class="op">=</span> <span class="va">USlifetables_num</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  Female <span class="op">=</span> <span class="va">USlifetables_num</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">common_ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">death_prob_clean</span><span class="op">$</span><span class="va">Age</span>, <span class="va">USlifetables_df</span><span class="op">$</span><span class="va">Age</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter both so only include the rows with matching Age</span></span>
<span><span class="va">death_prob_filtered</span> <span class="op">&lt;-</span> <span class="va">death_prob_clean</span><span class="op">[</span><span class="va">death_prob_clean</span><span class="op">$</span><span class="va">Age</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">common_ages</span>, <span class="op">]</span></span>
<span><span class="va">USlifetables_filtered</span> <span class="op">&lt;-</span> <span class="va">USlifetables_df</span><span class="op">[</span><span class="va">USlifetables_df</span><span class="op">$</span><span class="va">Age</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">common_ages</span>, <span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined_data_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">death_prob_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Source <span class="op">=</span> <span class="st">"epicUS"</span><span class="op">)</span>,</span>
<span>  <span class="va">USlifetables_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Source <span class="op">=</span> <span class="st">"US Life Tables"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"Sex"</span>, values_to <span class="op">=</span> <span class="st">"Death_Probability"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Age</span> <span class="op">&gt;</span> <span class="fl">40</span><span class="op">)</span>  </span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">combined_data_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Age</span>, y <span class="op">=</span> <span class="va">Death_Probability</span>, fill <span class="op">=</span> <span class="va">Source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Comparison of epicUS Death Probability vs. US Life Tables (time_horizon =1)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Death Probability"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Source:"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    legend.justification <span class="op">=</span> <span class="st">"center"</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>b <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="Reproducing_bgd_files/figure-html/unnamed-chunk-11-1.png" width="768"></p>
<p>When <code>time_horizon = 6</code>, we get the following plot.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">combined_data_long5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="va">death_prob5_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Source <span class="op">=</span> <span class="st">"epicUS"</span><span class="op">)</span>,</span>
<span>  <span class="va">USlifetables_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Source <span class="op">=</span> <span class="st">"US Life Tables"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"Sex"</span>, values_to <span class="op">=</span> <span class="st">"Death_Probability"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Age</span> <span class="op">&gt;</span> <span class="fl">40</span><span class="op">)</span>  </span>
<span></span>
<span></span>
<span><span class="va">final_EPIC_death5</span><span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">combined_data_long5</span>, <span class="va">Source</span> <span class="op">==</span> <span class="st">"epicUS"</span><span class="op">)</span></span>
<span><span class="va">final_US_death</span><span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">combined_data_long5</span>, <span class="va">Source</span> <span class="op">==</span> <span class="st">"US Life Tables"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add Death_Probability to USlifetables_filtered</span></span>
<span><span class="va">USlifetables_filtered_long</span> <span class="op">&lt;-</span> <span class="va">USlifetables_filtered</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"Sex"</span>, value <span class="op">=</span> <span class="st">"Death_Probability"</span>, <span class="va">Male</span>, <span class="va">Female</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through each unique year in the combined_data_long dataset</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">year</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">combined_data_long5</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Filter the data for the current year</span></span>
<span>  <span class="va">year_data</span> <span class="op">&lt;-</span> <span class="va">combined_data_long5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="va">year</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Create the plot for the current year</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">combined_data_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Age</span>, y <span class="op">=</span> <span class="va">Death_Probability</span>, fill <span class="op">=</span> <span class="va">Source</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Comparison of epicUS Death Probability vs. US Life Tables (time_horizon = 6)"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Death Probability"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Source:"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    legend.justification <span class="op">=</span> <span class="st">"center"</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span>, margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>b <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Print the plot for the current year</span></span>
<span>  <span class="co"># print(p)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p><img src="Reproducing_bgd_files/figure-html/unnamed-chunk-13-1.png" width="768">
When we break it down and analyze per year, it seems to be in line with
what we expect.</p>
</div>
<div class="section level3">
<h3 id="eliminating-smoking-mortality">Eliminating smoking mortality<a class="anchor" aria-label="anchor" href="#eliminating-smoking-mortality"></a>
</h3>
<p>We have identified a potential source of the observed mortality
discrepancies. Specifically, the mortality ratio associated with both
former and current smokers appears to be influencing the results.</p>
<p>To investigate this, we set the following smoking-related mortality
factors to 1 (indicating no excess mortality risk for former and current
smokers):</p>
<p>After making this adjustment, the results align more closely with the
life tables.</p>
<ul>
<li>This suggests that either:
<ul>
<li>The model may be generating an excessive number of current and
former smokers, leading to higher mortality than expected.</li>
<li>We will need to update the mortality ratio estimates depending on
whether an individual currently or formerly smokes.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">smoking</span><span class="op">$</span><span class="va">mortality_factor_former</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>age40to49<span class="op">=</span><span class="fl">1</span>,age50to59<span class="op">=</span><span class="fl">1</span>,</span>
<span>                                                 age60to69<span class="op">=</span><span class="fl">1</span>,age70to79<span class="op">=</span><span class="fl">1</span>,</span>
<span>                                                 age80p<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">smoking</span><span class="op">$</span><span class="va">mortality_factor_current</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>age40to49<span class="op">=</span><span class="fl">1</span>,age50to59<span class="op">=</span><span class="fl">1</span>,</span>
<span>                                                  age60to69<span class="op">=</span><span class="fl">1</span>,age70to79<span class="op">=</span><span class="fl">1</span>,</span>
<span>                                                  age80p<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Initializing the session</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; Terminating the session</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'age_and_local'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span></code></pre>
<p><img src="Reproducing_bgd_files/figure-html/unnamed-chunk-15-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="changing-the-intercept-of-logit_p_never_smoker_con_not_current_0_betas">Changing the intercept of
<code>logit_p_never_smoker_con_not_current_0_betas</code><a class="anchor" aria-label="anchor" href="#changing-the-intercept-of-logit_p_never_smoker_con_not_current_0_betas"></a>
</h3>
<p>Currently the model has too many former smokers. This can be adjusted
by increased the intercept of
<code>logit_p_never_smoker_con_not_current_0_betas</code>. So
first,instead of changing the mortality factors, we keep the mortality
factors for current and former smokers the same.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_default_settings.html">get_default_settings</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">settings</span><span class="op">$</span><span class="va">record_mode</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">settings</span><span class="op">$</span><span class="va">n_base_agents</span> <span class="op">&lt;-</span> <span class="fl">1e6</span></span>
<span></span>
<span><span class="fu"><a href="../reference/init_session.html">init_session</a></span><span class="op">(</span>settings <span class="op">=</span> <span class="va">settings</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initializing the session</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="va">input</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/get_input.html">get_input</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_horizon</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">global_parameters</span><span class="op">$</span><span class="va">time_horizon</span> <span class="op">&lt;-</span> <span class="va">time_horizon</span></span>
<span></span>
<span><span class="co"># kept the same</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">smoking</span><span class="op">$</span><span class="va">mortality_factor_current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>age40to49 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                        age50to59 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                        age60to69 <span class="op">=</span> <span class="fl">1.94</span>,</span>
<span>                                                        age70to79 <span class="op">=</span> <span class="fl">1.86</span>,</span>
<span>                                                        age80p <span class="op">=</span> <span class="fl">1.66</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># kept the same</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">smoking</span><span class="op">$</span><span class="va">mortality_factor_former</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>age40to49 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                      age50to59 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                      age60to69 <span class="op">=</span> <span class="fl">1.54</span>,</span>
<span>                                                      age70to79 <span class="op">=</span> <span class="fl">1.36</span>,</span>
<span>                                                      age80p <span class="op">=</span> <span class="fl">1.27</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then, we adjust the intercept to ensure that the ratio of
never-smokers to the total population is approximately 0.21. We modify
the intercept accordingly to achieve this target.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Probability of being a never-smoker conditional on not being current smoker,</span></span>
<span><span class="co"># at the time of creation</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">smoking</span><span class="op">$</span><span class="va">logit_p_never_smoker_con_not_current_0_betas</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">4.85</span>, sex <span class="op">=</span> <span class="fl">0</span>, age <span class="op">=</span> <span class="op">-</span><span class="fl">0.06</span>, age2 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                sex_age <span class="op">=</span> <span class="fl">0</span>,sex_age2 <span class="op">=</span> <span class="fl">0</span>, year <span class="op">=</span> <span class="op">-</span><span class="fl">0.02</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/Cget_all_events_matrix.html">Cget_all_events_matrix</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/terminate_session.html">terminate_session</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Terminating the session</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span></span>
<span><span class="co"># checking the ratio</span></span>
<span><span class="va">output</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/Cget_output_ex.html">Cget_output_ex</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">smoking_num</span><span class="op">&lt;-</span><span class="va">output</span><span class="op">$</span><span class="va">n_smoking_status_by_ctime</span></span>
<span><span class="va">never_smoker_ratio</span> <span class="op">&lt;-</span> <span class="va">smoking_num</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">smoking_num</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">never_smoker_ratio</span></span>
<span><span class="co">#&gt; [1] 0.2109738</span></span></code></pre></div>
<p>Now we can visualize the change:</p>
<pre><code><span><span class="co">#&gt; `summarise()` has grouped output by 'age_and_local'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span></code></pre>
<p><img src="Reproducing_bgd_files/figure-html/unnamed-chunk-18-1.png" width="768"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mohsen Sadatsafavi, Amin Adibi, Kate Johnson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
